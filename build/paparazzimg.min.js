/*!
 * Paparazzimg
 * https://github.com/nyratas/paparazzimg
 *
 * Copyright (c) 2016 Toon Van den Bos
 * Licensed under the MIT license.
 */
"use strict";var paparazzimg=function(t){function i(){window.addEventListener("resize",t.addTrackpoint,!1)}function e(i){return null===i||void 0===i?!1:i.nodeType?new t.tracker(i):(console.error("Paparazzimg: variable is not a valid DOM element."),!1)}function s(t){d[t.id]=t,d[t.id].setActive()}function n(t){return void 0===l[t]?l[t]=[t]:l[t].push(t+l[t].length),l[t][l[t].length-1]}function h(t){return void 0!==d[t]?(d[t].setInactive(),d[t].report()):null}function a(){var t,i={};for(t in d)i[t]=h(t);return i}function o(t){d[t].isActive&&d[t].point()}function r(){for(var t in d)o(t)}function u(i,e){var s,n=[];if(d[i].isActive&&h(i),void 0===e)for(e in d[i].output.optimal)n.push(new t.canvas(d[i],e));else if(void 0===d[i].output.optimal[e]){s='Paparazzimg: mode "'+e+'" is not a defined render mode (defined modes are:';for(e in d[i].output.optimal)s=s+' "'+e+'",';s=s.slice(0,-1)+").",console.error(s)}else n.push(new t.canvas(d[i],e));return n}function c(t){var i,e,s=[];for(e in d){i=u(e,t);for(var n=0;n<i.length;n++)s.push(i[n])}return s}var d={},l={};return t.track=function(t){var i=e(t);i&&s(i)},t.release=function(t){return void 0==t?a():h(t)},t.addId=function(t){return t=t.toLowerCase(),n(t)},t.addTrackpoint=function(t){"String"==typeof t&&o(t),r()},t.download=function(t,i){return void 0==i?c(t):u(i,t)},i(),t}(paparazzimg||{});paparazzimg.canvas=function(t,i){this.mode=null,this.file=null,this.canvas=null,this.ctx=null,this.conf={colors:{base:{r:63,g:74,b:78,a:1},baseBg:{r:198,g:214,b:220,a:.2},always:{r:149,g:202,b:128,a:1},alwaysBg:{r:149,g:202,b:128,a:.4},normal:{r:180,g:180,b:180,a:1},normalBg:{r:180,g:180,b:180,a:.1}},line:1,baseLine:4},this.init=function(){console.log(t.breaks),this.makeName(),this.makeCanvas(),this.drawBase(),this.drawBreaks(),document.body.appendChild(this.canvas)},this.makeName=function(){this.mode=i,this.file=t.id+"-"+this.mode+".png"},this.makeCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=t.output.optimal[i].width,this.canvas.height=t.output.optimal[i].height,this.ctx=this.canvas.getContext("2d"),this.ctx.lineJoin="round",this.ctx.lineCap="round"},this.drawBase=function(){this.ctx.lineWidth=this.conf.baseLine,this.ctx.strokeStyle=this.getRgba(this.conf.colors.base),this.ctx.fillStyle=this.getRgba(this.conf.colors.baseBg),this.ctx.beginPath(),this.ctx.rect(this.conf.baseLine/2,this.conf.baseLine/2,this.canvas.width-this.conf.baseLine,this.canvas.height-this.conf.baseLine),this.ctx.fill(),this.ctx.moveTo(this.conf.baseLine,this.conf.baseLine),this.ctx.lineTo(this.canvas.width-this.conf.baseLine,this.canvas.height-this.conf.baseLine),this.ctx.moveTo(this.conf.baseLine,this.canvas.height-this.conf.baseLine),this.ctx.lineTo(this.canvas.width-this.conf.baseLine,this.conf.baseLine),this.ctx.stroke()},this.drawBreaks=function(){var i,e;for(i in t.breaks)e=void 0===this.conf.colors[i.replace("-","")]?"normal":i.replace("-",""),this.drawBreak(e,this.adjustModeSize(i,t.breaks[i]))},this.drawBreak=function(t,i){this.ctx.lineWidth=this.conf.line,this.ctx.strokeStyle=this.getRgba(this.conf.colors[t]),this.ctx.fillStyle=this.getRgba(this.conf.colors[t+"Bg"]),this.ctx.beginPath(),this.ctx.rect(this.getPX(i.width),this.getPY(i.height),i.width,i.height),this.ctx.fill(),this.ctx.stroke()},this.getRgba=function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},this.getPX=function(t){return(this.canvas.width-t)/2},this.getPY=function(t){return(this.canvas.height-t)/2},this.adjustModeSize=function(t,i){var e={width:i.width,height:i.height,ratio:i.ratio};switch(this.mode){case"fluidWidth":return this.adjustFluidWidth(t,e);case"fluidHeight":return this.adjustFluidHeight(t,e);default:return e}},this.adjustFluidWidth=function(t,i){return i.width=this.canvas.width,"always"!=t&&(i.height=i.width/i.ratio),i},this.adjustFluidHeight=function(t,i){return i.height=this.canvas.height,"always"!=t&&(i.width=i.ratio*i.height),i},this.init()},paparazzimg.tracker=function(t){this.element=null,this.id=null,this.points=[],this.output=null,this.breaks=null,this.isActive=!1,this.init=function(t){this.element=t,this.setId()},this.setId=function(){this.element.getAttribute("id")?this.id=paparazzimg.addId(this.element.getAttribute("id")):(this.id=paparazzimg.addId(this.element.nodeName),this.element.setAttribute("id",this.id))},this.setActive=function(){this.isActive=!0},this.setInactive=function(){this.isActive=!1},this.report=function(){return this.breaks={},this.makeOutput(),this.addMinBreak(),this.reset(),this.output},this.point=function(){this.points.push(this.getPoint())},this.reset=function(){this.points=[]},this.getPoint=function(){var t={};return t.width=this.element.clientWidth,t.height=this.element.clientHeight,t.ratio=t.width/t.height,t},this.makeOutput=function(){this.output={},this.output.count=this.points.length,this.output.extremum=this.getExtremum(),this.output.optimal=this.getOptimal()},this.getExtremum=function(){var t,i,e={},s={};for(t=0;t<this.points.length;t++)for(i in this.points[t])void 0===e[i]?(e[i]={min:this.points[t][i],max:this.points[t][i]},s[i]={min:this.points[t],max:this.points[t]}):this.points[t][i]>e[i].max?(e[i].max=this.points[t][i],s[i].max=this.points[t]):this.points[t][i]<e[i].min&&(e[i].min=this.points[t][i],s[i].min=this.points[t]);return this.addExtremumBreaks(s),e},this.getOptimal=function(){var t={};return t.static=this.getStaticSize(),t.fluidWidth=this.getFluidWidthSize(),t.fluidHeight=this.getFluidHeightSize(),t},this.getStaticSize=function(){return{width:Math.ceil(this.output.extremum.width.max),height:Math.ceil(this.output.extremum.height.max)}},this.getFluidWidthSize=function(){return{width:Math.ceil(this.output.extremum.height.max*this.output.extremum.ratio.max),height:Math.ceil(this.output.extremum.width.max/this.output.extremum.ratio.min)}},this.getFluidHeightSize=function(){return{width:Math.ceil(this.output.extremum.height.min*this.output.extremum.ratio.max),height:Math.ceil(this.output.extremum.width.min/this.output.extremum.ratio.min)}},this.addBreak=function(t,i,e,s){var n={};n.width=i>0||0===i?i:null,n.height=e>0||0===e?e:null,n.ratio=s,this.breaks[t]=n},this.addExtremumBreaks=function(t){var i,e;for(i in t)for(e in t[i])this.addBreak(e+"-"+i,t[i][e].width,t[i][e].height,t[i][e].ratio)},this.addMinBreak=function(){this.addBreak("always",this.output.extremum.width.min,this.output.extremum.height.min,null)},this.init(t)};